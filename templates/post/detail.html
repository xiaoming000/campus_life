{% extends 'base.html' %}
{% load staticfiles %}
{% load post_tags %}
{% block head %}
<script>
    // tinyMCE.init({
    //         'mode':'textareas',
    //         'theme':'modern',
    //     });
    $(function () {
        $(".comment_body").mousemove(function () {
            $(this).find(".reply_comment").css('display', 'inline').click(function () {
                $(this).parent().next(".reply_form").css('display', 'block');
                $(this).parents("li").siblings().find(".reply_form").css('display', 'none');
            });
        });

        $(".comment_body").mouseout(function () {
            $(this).find('.reply_comment').css('display', 'none');
        });

        $(".reply_form_close").click(function () {
            $(this).parents(".reply_form").css('display', 'none');
        });

        $(".reply").mousemove(function () {
            $(this).find(".reply_r").css('display', 'inline').click(function () {
                $(this).parent().next(".r_r_form").css('display', 'block');
            });
        });
        $(".reply").mouseout(function () {
            $(this).find(".reply_r").css('display', 'none');
        });
        $(".r_r_form_close").click(function () {
            $(this).parents(".r_r_form").css('display', 'none');
        });
    });
</script>
{% endblock head %}
{% block main %}
<div class="container">
    <div class="row clearfix">
        <div class="col-lg-9">
            <h2 style="text-align: center;">{{post.title}}</h2>
            <p>{{post.content | safe}}</p>

            <div>
                <div>
                    <form method="post" action="{% url 'post:post_comment' post.pk %}">
                        {% csrf_token %}
                        <!--<input type="hidden"  >-->
                        <div class="form-group">
                            <label for="comment">评论</label>
                            <textarea class="form-control" id="comment" name='content' rows="3"></textarea>
                        </div>
                        {{ form.content.errors }}
                        <input type="submit" value="提交">
                    </form>
                </div>
                <div>
                    <ul class="comment_list list-unstyled">
                        {% for comment in comment_list %}
                        <li class="comment-item clearfix">
                            <div class="panel panel-default ">
                                <div class="panel-body comment_body">
                                    <span class="nickname" style="color: #7ebfff;">{{ comment.user.username }}</span>
                                    <time class="submit-date">{{ comment.created_time }}</time>
                                    <div class="text comment_text">
                                        <div class="comment" style="display: block;">
                                            <span style="padding: 5px 10px;">{{ comment.content|safe }}</span>
                                            <span class="reply_comment" style="color: #7ebfff;display: none;cursor: pointer;padding: 5px 0px;">回复</span>
                                        </div>
                                        <div class="reply_form col-lg-10" style="display: none;">
                                            <form role="form" method="post" action="{%url 'post:post_reply' post.pk %}">
                                                {% csrf_token %}
                                                <input type="hidden" name="reply_type" value="0">
                                                <input type="hidden" name="post_comment" value="{{comment.id}}">
                                                <input type="hidden" name="reply" value="">
                                                <div class="form-group">
                                                    <textarea class="form-control" rows="2" name="content"  placeholder="回复{{comment.user.username}}："></textarea>
                                                </div>
                                                {% for field in reply_form %}
                                                    {{ field.errors }}
                                                {% endfor %}
                                                <div class="form-group">
                                                    <div class="btn-group pull-right">
                                                        <button type="button" class="btn btn-default reply_form_close">关闭</button>
                                                        <button type="submit" class="btn btn-default">发表</button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                    <div  class="reply_list" style="padding-left: 10px;">
                                        <ul class="list-unstyled">
                                        {% for reply in comment.postreply_set.all %}
                                            <li>
                                                <div class="reply">
                                                    <div class="clearfix col-lg-12" style="padding: 5px 5px;display: block;">
                                                        <span style="color: #7ebfff;">{{reply.user.username}}</span>
                                                        <span class="glyphicon glyphicon-share-alt"></span>

                                                        {% if reply.reply %}
                                                        <span style="color: #7ebfff;">{{reply.reply.user.username}}</span>
                                                        {% else %}
                                                        <span style="color: #7ebfff;">{{comment.user.username}}</span>
                                                        {% endif %}

                                                        <span> : {{reply.content}}</span>
                                                        <span class="reply_r" style="color: #7ebfff;display: none;cursor: pointer;padding: 0px 5px;">回复</span>
                                                    </div>
                                                    <div class="r_r_form col-lg-10 clearfix" style="display: none;">
                                                        <form role="form" method="post" action="{%url 'post:post_reply' post.pk %}">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="reply_type" value="1">
                                                            <input type="hidden" name="post_comment" value="{{comment.id}}">
                                                            <input type="hidden" name="reply" value="{{reply.id}}">
                                                            <div class="form-group">
                                                                <textarea class="form-control" rows="2" name="content"  placeholder="回复{{comment.user.username}}："></textarea>
                                                            </div>
                                                            {% for field in reply_form %}
                                                                {{ field.errors }}
                                                            {% endfor %}
                                                            <div class="form-group clearfix">
                                                                <div class="btn-group pull-right">
                                                                    <button type="button" class="btn btn-default r_r_form_close">关闭</button>
                                                                    <button type="submit" class="btn btn-default">发表</button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </li>
                                        {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% empty %}
                        暂无评论
                        {% endfor %}
                    </ul>
                </div>
            </div>

        </div>

        <div class="col-lg-3" style="">
            <ul class="list-group">
                <li class="list-group-item">
                    <h4>文章目录</h4>
                    {{ post.toc|safe }}
                </li>
                <li class="list-group-item">
                    <h4>TA的最新文章</h4>
                    {% get_recent_post post.auther as recent_post_list %}
                    <ul>
                        {% for post in recent_post_list %}
                        <li>
                          <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
                        </li>
                        {% empty %}
                        暂无文章！
                        {% endfor %}
                    </ul>
                </li>
                <li class="list-group-item">
                    <h4>文章标签</h4>
                    {% for tag in tags_list %}
                    <button type="button" class="btn btn-default">{{tag.name}}</button>
                    {% endfor %}
                </li>
            </ul>
        </div>
    </div>
</div>



{% endblock main %}


